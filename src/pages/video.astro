---
import Layout from "../layouts/Layout.astro";
import { Image } from "astro:assets";
import BannerTitle from "../components/BannerTitle.astro";
// import Breadcrumb from "../components/Breadcrumb.astro";
import client from '../lib/apolloClient';
import { GET_VIDEOS, GET_TEMPLATE } from '../lib/queries';

const { data: templateData } = await client.query({
  query: GET_TEMPLATE,
  variables: { slug: 'video' }
});
const { data: videosData } = await client.query({ query: GET_VIDEOS });

const page = templateData.templateBy;
const videos = videosData.videos.nodes;

const title = page?.title || `Video`;
---

<Layout title={title}>
  <BannerTitle
    title={title}
    subtitle={page?.subtitle}
    image={page?.bannerImage?.sourceUrl}
    width={page?.bannerImage?.mediaDetails.width}
    height={page?.bannerImage?.mediaDetails.height}
  />
  <div class="container mx-auto">
    {page?.content && (
      <div class="content" set:html={page?.content} />
    )}

    <div class="video">
      {videos.map((video) => (
        <div key={video.databaseId} class="pb-4 border-b-2 blog-post">
          <h3 class="mb-2">
            <a href={`/video/${video.slug}`} class="no-underline">{video.title}</a>
          </h3>
          <div class="flex">
            {video.featuredImage && (
              <a href={`/video/${video.slug}`}>
                <Image
                  src={video.featuredImage.node.sourceUrl}
                  width={150}
                  height={150}
                  alt={`Featured image for ${video.title}`}
                  class="w-24 mr-4 lg:w-32"
                />
              </a>
            )}
            <div class="">
              <div class="flex-grow blog-excerpt" set:html={video.excerpt} />
              <div class="mt-4 uppercase">
                <a href={`/video/${video.slug}`} class="no-underline">Watch Video</a>
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</Layout>